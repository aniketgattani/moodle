!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.Pusher=b():a.Pusher=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";var d=c(1);a.exports=d["default"]},function(a,b,c){"use strict";function d(a){if(null===a||void 0===a)throw"You must pass your app key when you instantiate Pusher."}var e=c(2),f=c(9),g=c(23),h=c(38),i=c(39),j=c(40),k=c(12),l=c(5),m=c(62),n=c(8),o=c(42),p=function(){function a(b,c){var k=this;d(b),c=c||{},this.key=b,this.config=f.extend(m.getGlobalConfig(),c.cluster?m.getClusterConfig(c.cluster):{},c),this.channels=o["default"].createChannels(),this.global_emitter=new g["default"],this.sessionID=Math.floor(1e9*Math.random()),this.timeline=new h["default"](this.key,this.sessionID,{cluster:this.config.cluster,features:a.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:i["default"].INFO,version:l["default"].VERSION}),this.config.disableStats||(this.timelineSender=o["default"].createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+e["default"].TimelineTransport.name}));var p=function(a){var b=f.extend({},k.config,a);return j.build(e["default"].getDefaultStrategy(b),b)};this.connection=o["default"].createConnectionManager(this.key,f.extend({getStrategy:p,timeline:this.timeline,activityTimeout:this.config.activity_timeout,pongTimeout:this.config.pong_timeout,unavailableTimeout:this.config.unavailable_timeout},this.config,{encrypted:this.isEncrypted()})),this.connection.bind("connected",function(){k.subscribeAll(),k.timelineSender&&k.timelineSender.send(k.connection.isEncrypted())}),this.connection.bind("message",function(a){var b=0===a.event.indexOf("pusher_internal:");if(a.channel){var c=k.channel(a.channel);c&&c.handleEvent(a.event,a.data)}b||k.global_emitter.emit(a.event,a.data)}),this.connection.bind("connecting",function(){k.channels.disconnect()}),this.connection.bind("disconnected",function(){k.channels.disconnect()}),this.connection.bind("error",function(a){n["default"].warn("Error",a)}),a.instances.push(this),this.timeline.info({instances:a.instances.length}),a.isReady&&this.connect()}return a.ready=function(){a.isReady=!0;for(var b=0,c=a.instances.length;b<c;b++)a.instances[b].connect()},a.log=function(b){a.logToConsole&&window.console&&window.console.log&&window.console.log(b)},a.getClientFeatures=function(){return f.keys(f.filterObject({ws:e["default"].Transports.ws},function(a){return a.isSupported({})}))},a.prototype.channel=function(a){return this.channels.find(a)},a.prototype.allChannels=function(){return this.channels.all()},a.prototype.connect=function(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var a=this.connection.isEncrypted(),b=this.timelineSender;this.timelineSenderTimer=new k.PeriodicTimer(6e4,function(){b.send(a)})}},a.prototype.disconnect=function(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)},a.prototype.bind=function(a,b,c){return this.global_emitter.bind(a,b,c),this},a.prototype.unbind=function(a,b,c){return this.global_emitter.unbind(a,b,c),this},a.prototype.bind_global=function(a){return this.global_emitter.bind_global(a),this},a.prototype.unbind_global=function(a){return this.global_emitter.unbind_global(a),this},a.prototype.unbind_all=function(a){return this.global_emitter.unbind_all(),this},a.prototype.subscribeAll=function(){var a;for(a in this.channels.channels)this.channels.channels.hasOwnProperty(a)&&this.subscribe(a)},a.prototype.subscribe=function(a){var b=this.channels.add(a,this);return b.subscriptionPending&&b.subscriptionCancelled?b.reinstateSubscription():b.subscriptionPending||"connected"!==this.connection.state||b.subscribe(),b},a.prototype.unsubscribe=function(a){var b=this.channels.find(a);b&&b.subscriptionPending?b.cancelSubscription():(b=this.channels.remove(a),b&&"connected"===this.connection.state&&b.unsubscribe())},a.prototype.send_event=function(a,b,c){return this.connection.send_event(a,b,c)},a.prototype.isEncrypted=function(){return"https:"===e["default"].getProtocol()||Boolean(this.config.encrypted)},a.instances=[],a.isReady=!1,a.logToConsole=!1,a.Runtime=e["default"],a.ScriptReceivers=e["default"].ScriptReceivers,a.DependenciesReceivers=e["default"].DependenciesReceivers,a.auth_callbacks=e["default"].auth_callbacks,a}();b.__esModule=!0,b["default"]=p,e["default"].setup(p)},function(a,b,c){"use strict";var d=c(3),e=c(7),f=c(14),g=c(15),h=c(16),i=c(4),j=c(17),k=c(18),l=c(25),m=c(26),n=c(27),o=c(28),p={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:i.ScriptReceivers,DependenciesReceivers:d.DependenciesReceivers,getDefaultStrategy:m["default"],Transports:k["default"],transportConnectionInitializer:n["default"],HTTPFactory:o["default"],TimelineTransport:j["default"],getXHRAPI:function(){return window.XMLHttpRequest},getWebSocketAPI:function(){return window.WebSocket||window.MozWebSocket},setup:function(a){var b=this;window.Pusher=a;var c=function(){b.onDocumentBody(a.ready)};window.JSON?c():d.Dependencies.load("json2",{},c)},getDocument:function(){return document},getProtocol:function(){return this.getDocument().location.protocol},getAuthorizers:function(){return{ajax:e["default"],jsonp:f["default"]}},onDocumentBody:function(a){var b=this;document.body?a():setTimeout(function(){b.onDocumentBody(a)},0)},createJSONPRequest:function(a,b){return new h["default"](a,b)},createScriptRequest:function(a){return new g["default"](a)},getLocalStorage:function(){try{return window.localStorage}catch(a){return}},createXHR:function(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest:function(){var a=this.getXHRAPI();return new a},createMicrosoftXHR:function(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork:function(){return l.Network},createWebSocket:function(a){var b=this.getWebSocketAPI();return new b(a)},createSocketRequest:function(a,b){if(this.isXHRSupported())return this.HTTPFactory.createXHR(a,b);if(this.isXDRSupported(0===b.indexOf("https:")))return this.HTTPFactory.createXDR(a,b);throw"Cross-origin HTTP requests are not supported"},isXHRSupported:function(){var a=this.getXHRAPI();return Boolean(a)&&void 0!==(new a).withCredentials},isXDRSupported:function(a){var b=a?"https:":"http:",c=this.getProtocol();return Boolean(window.XDomainRequest)&&c===b},addUnloadListener:function(a){void 0!==window.addEventListener?window.addEventListener("unload",a,!1):void 0!==window.attachEvent&&window.attachEvent("onunload",a)},removeUnloadListener:function(a){void 0!==window.addEventListener?window.removeEventListener("unload",a,!1):void 0!==window.detachEvent&&window.detachEvent("onunload",a)}};b.__esModule=!0,b["default"]=p},function(a,b,c){"use strict";var d=c(4),e=c(5),f=c(6);b.DependenciesReceivers=new d.ScriptReceiverFactory("_pusher_dependencies","Pusher.DependenciesReceivers"),b.Dependencies=new f["default"]({cdn_http:e["default"].cdn_http,cdn_https:e["default"].cdn_https,version:e["default"].VERSION,suffix:e["default"].dependency_suffix,receivers:b.DependenciesReceivers})},function(a,b){"use strict";var c=function(){function a(a,b){this.lastId=0,this.prefix=a,this.name=b}return a.prototype.create=function(a){this.lastId++;var b=this.lastId,c=this.prefix+b,d=this.name+"["+b+"]",e=!1,f=function(){e||(a.apply(null,arguments),e=!0)};return this[b]=f,{number:b,id:c,name:d,callback:f}},a.prototype.remove=function(a){delete this[a.number]},a}();b.ScriptReceiverFactory=c,b.ScriptReceivers=new c("_pusher_script_","Pusher.ScriptReceivers")},function(a,b){"use strict";var c={VERSION:"4.0.0",PROTOCOL:7,host:"ws.pusherapp.com",ws_port:80,wss_port:443,sockjs_host:"sockjs.pusher.com",sockjs_http_port:80,sockjs_https_port:443,sockjs_path:"/pusher",stats_host:"stats.pusher.com",channel_auth_endpoint:"/pusher/auth",channel_auth_transport:"ajax",activity_timeout:12e4,pong_timeout:3e4,unavailable_timeout:1e4,cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""};b.__esModule=!0,b["default"]=c},function(a,b,c){"use strict";var d=c(4),e=c(2),f=function(){function a(a){this.options=a,this.receivers=a.receivers||d.ScriptReceivers,this.loading={}}return a.prototype.load=function(a,b,c){var d=this;if(d.loading[a]&&d.loading[a].length>0)d.loading[a].push(c);else{d.loading[a]=[c];var f=e["default"].createScriptRequest(d.getPath(a,b)),g=d.receivers.create(function(b){if(d.receivers.remove(g),d.loading[a]){var c=d.loading[a];delete d.loading[a];for(var e=function(a){a||f.cleanup()},h=0;h<c.length;h++)c[h](b,e)}});f.send(g)}},a.prototype.getRoot=function(a){var b,c=e["default"].getDocument().location.protocol;return b=a&&a.encrypted||"https:"===c?this.options.cdn_https:this.options.cdn_http,b.replace(/\/*$/,"")+"/"+this.options.version},a.prototype.getPath=function(a,b){return this.getRoot(b)+"/"+a+this.options.suffix+".js"},a}();b.__esModule=!0,b["default"]=f},function(a,b,c){"use strict";var d=c(8),e=c(2),f=function(a,b,c){var f,g=this;f=e["default"].createXHR(),f.open("POST",g.options.authEndpoint,!0),f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var h in this.authOptions.headers)f.setRequestHeader(h,this.authOptions.headers[h]);return f.onreadystatechange=function(){if(4===f.readyState)if(200===f.status){var a,b=!1;try{a=JSON.parse(f.responseText),b=!0}catch(e){c(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+f.responseText)}b&&c(!1,a)}else d["default"].warn("Couldn't get auth info from your webapp",f.status),c(!0,f.status)},f.send(this.composeQuery(b)),f};b.__esModule=!0,b["default"]=f},function(a,b,c){"use strict";var d=c(9),e=c(1),f={debug:function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];e["default"].log&&e["default"].log(d.stringify.apply(this,arguments))},warn:function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=d.stringify.apply(this,arguments);window.console&&(window.console.warn?window.console.warn(c):window.console.log&&window.console.log(c)),e["default"].log&&e["default"].log(c)}};b.__esModule=!0,b["default"]=f},function(a,b,c){"use strict";function d(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];for(var e=0;e<b.length;e++){var f=b[e];for(var g in f)f[g]&&f[g].constructor&&f[g].constructor===Object?a[g]=d(a[g]||{},f[g]):a[g]=f[g]}return a}function e(){for(var a=["Pusher"],b=0;b<arguments.length;b++)"string"==typeof arguments[b]?a.push(arguments[b]):a.push(u(arguments[b]));return a.join(" : ")}function f(a,b){var c=Array.prototype.indexOf;if(null===a)return-1;if(c&&a.indexOf===c)return a.indexOf(b);for(var d=0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1}function g(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(a[c],c,a)}function h(a){var b=[];return g(a,function(a,c){b.push(c)}),b}function i(a){var b=[];return g(a,function(a){b.push(a)}),b}function j(a,b,c){for(var d=0;d<a.length;d++)b.call(c||window,a[d],d,a)}function k(a,b){for(var c=[],d=0;d<a.length;d++)c.push(b(a[d],d,a,c));return c}function l(a,b){var c={};return g(a,function(a,d){c[d]=b(a)}),c}function m(a,b){b=b||function(a){return!!a};for(var c=[],d=0;d<a.length;d++)b(a[d],d,a,c)&&c.push(a[d]);return c}function n(a,b){var c={};return g(a,function(d,e){(b&&b(d,e,a,c)||Boolean(d))&&(c[e]=d)}),c}function o(a){var b=[];return g(a,function(a,c){b.push([c,a])}),b}function p(a,b){for(var c=0;c<a.length;c++)if(b(a[c],c,a))return!0;return!1}function q(a,b){for(var c=0;c<a.length;c++)if(!b(a[c],c,a))return!1;return!0}function r(a){return l(a,function(a){return"object"==typeof a&&(a=u(a)),encodeURIComponent(v["default"](a.toString()))})}function s(a){var b=n(a,function(a){return void 0!==a}),c=k(o(r(b)),w["default"].method("join","=")).join("&");return c}function t(a){var b=[],c=[];return function d(a,e){var f,g,h;switch(typeof a){case"object":if(!a)return null;for(f=0;f<b.length;f+=1)if(b[f]===a)return{$ref:c[f]};if(b.push(a),c.push(e),"[object Array]"===Object.prototype.toString.apply(a))for(h=[],f=0;f<a.length;f+=1)h[f]=d(a[f],e+"["+f+"]");else{h={};for(g in a)Object.prototype.hasOwnProperty.call(a,g)&&(h[g]=d(a[g],e+"["+JSON.stringify(g)+"]"))}return h;case"number":case"string":case"boolean":return a}}(a,"$")}function u(a){try{return JSON.stringify(a)}catch(b){return JSON.stringify(t(a))}}var v=c(10),w=c(11);b.extend=d,b.stringify=e,b.arrayIndexOf=f,b.objectApply=g,b.keys=h,b.values=i,b.apply=j,b.map=k,b.mapObject=l,b.filter=m,b.filterObject=n,b.flatten=o,b.any=p,b.all=q,b.encodeParamsObject=r,b.buildQueryString=s,b.decycleObject=t,b.safeJSONStringify=u},function(a,b,c){"use strict";function d(a){return m(k(a))}b.__esModule=!0,b["default"]=d;for(var e=String.fromCharCode,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g={},h=0,i=f.length;h<i;h++)g[f.charAt(h)]=h;var j=function(a){var b=a.charCodeAt(0);return b<128?a:b<2048?e(192|b>>>6)+e(128|63&b):e(224|b>>>12&15)+e(128|b>>>6&63)+e(128|63&b)},k=function(a){return a.replace(/[^\x00-\x7F]/g,j)},l=function(a){var b=[0,2,1][a.length%3],c=a.charCodeAt(0)<<16|(a.length>1?a.charCodeAt(1):0)<<8|(a.length>2?a.charCodeAt(2):0),d=[f.charAt(c>>>18),f.charAt(c>>>12&63),b>=2?"=":f.charAt(c>>>6&63),b>=1?"=":f.charAt(63&c)];return d.join("")},m=window.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,l)}},function(a,b,c){"use strict";var d=c(12),e={now:function(){return Date.now?Date.now():(new Date).valueOf()},defer:function(a){return new d.OneOffTimer(0,a)},method:function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d=Array.prototype.slice.call(arguments,1);return function(b){return b[a].apply(b,d.concat(arguments))}}};b.__esModule=!0,b["default"]=e},function(a,b,c){"use strict";function d(a){window.clearTimeout(a)}function e(a){window.clearInterval(a)}var f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},g=c(13),h=function(a){function b(b,c){a.call(this,setTimeout,d,b,function(a){return c(),null})}return f(b,a),b}(g["default"]);b.OneOffTimer=h;var i=function(a){function b(b,c){a.call(this,setInterval,e,b,function(a){return c(),a})}return f(b,a),b}(g["default"]);b.PeriodicTimer=i},function(a,b){"use strict";var c=function(){function a(a,b,c,d){var e=this;this.clear=b,this.timer=a(function(){e.timer&&(e.timer=d(e.timer))},c)}return a.prototype.isRunning=function(){return null!==this.timer},a.prototype.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)},a}();b.__esModule=!0,b["default"]=c},function(a,b,c){"use strict";var d=c(8),e=function(a,b,c){void 0!==this.authOptions.headers&&d["default"].warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var e=a.nextAuthCallbackID.toString();a.nextAuthCallbackID++;var f=a.getDocument(),g=f.createElement("script");a.auth_callbacks[e]=function(a){c(!1,a)};var h="Pusher.auth_callbacks['"+e+"']";g.src=this.options.authEndpoint+"?callback="+encodeURIComponent(h)+"&"+this.composeQuery(b);var i=f.getElementsByTagName("head")[0]||f.documentElement;i.insertBefore(g,i.firstChild)};b.__esModule=!0,b["default"]=e},function(a,b){"use strict";var c=function(){function a(a){this.src=a}return a.prototype.send=function(a){var b=this,c="Error loading "+b.src;b.script=document.createElement("script"),b.script.id=a.id,b.script.src=b.src,b.script.type="text/javascript",b.script.charset="UTF-8",b.script.addEventListener?(b.script.onerror=function(){a.callback(c)},b.script.onload=function(){a.callback(null)}):b.script.onreadystatechange=function(){"loaded"!==b.script.readyState&&"complete"!==b.script.readyState||a.callback(null)},void 0===b.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(b.errorScript=document.createElement("script"),b.errorScript.id=a.id+"_error",b.errorScript.text=a.name+"('"+c+"');",b.script.async=b.errorScript.async=!1):b.script.async=!0;var d=document.getElementsByTagName("head")[0];d.insertBefore(b.script,d.firstChild),b.errorScript&&d.insertBefore(b.errorScript,b.script.nextSibling)},a.prototype.cleanup=function(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null},a}();b.__esModule=!0,b["default"]=c},function(a,b,c){"use strict";var d=c(9),e=c(2),f=function(){function a(a,b){this.url=a,this.data=b}return a.prototype.send=function(a){if(!this.request){var b=d.buildQueryString(this.data),c=this.url+"/"+a.number+"?"+b;this.request=e["default"].createScriptRequest(c),this.request.send(a)}},a.prototype.cleanup=function(){this.request&&this.request.cleanup()},a}();b.__esModule=!0,b["default"]=f},function(a,b,c){"use strict";var d=c(2),e=c(4),f=function(a,b){return function(c,f){var g="http"+(b?"s":"")+"://",h=g+(a.host||a.options.host)+a.options.path,i=d["default"].createJSONPRequest(h,c),j=d["default"].ScriptReceivers.create(function(b,c){e.ScriptReceivers.remove(j),i.cleanup(),c&&c.host&&(a.host=c.host),f&&f(b,c)});i.send(j)}},g={name:"jsonp",getAgent:f};b.__esModule=!0,b["default"]=g},function(a,b,c){"use strict";var d=c(19),e=c(21),f=c(20),g=c(2),h=c(3),i=c(9),j=new e["default"]({file:"sockjs",urls:f.sockjs,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(a,b){return new window.SockJS(a,null,{js_path:h.Dependencies.getPath("sockjs",{encrypted:b.encrypted}),ignore_null_origin:b.ignoreNullOrigin})},beforeOpen:function(a,b){a.send(JSON.stringify({path:b}))}}),k={isSupported:function(a){var b=g["default"].isXDRSupported(a.encrypted);return b}},l=new e["default"](i.extend({},d.streamingConfiguration,k)),m=new e["default"](i.extend({},d.pollingConfiguration,k));d["default"].xdr_streaming=l,d["default"].xdr_polling=m,d["default"].sockjs=j,b.__esModule=!0,b["default"]=d["default"]},function(a,b,c){"use strict";var d=c(20),e=c(21),f=c(9),g=c(2),h=new e["default"]({urls:d.ws,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(g["default"].getWebSocketAPI())},isSupported:function(){return Boolean(g["default"].getWebSocketAPI())},getSocket:function(a){return g["default"].createWebSocket(a)}}),i={urls:d.http,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}};b.streamingConfiguration=f.extend({getSocket:function(a){return g["default"].HTTPFactory.createStreamingSocket(a)}},i),b.pollingConfiguration=f.extend({getSocket:function(a){return g["default"].HTTPFactory.createPollingSocket(a)}},i);var j={isSupported:function(){return g["default"].isXHRSupported()}},k=new e["default"](f.extend({},b.streamingConfiguration,j)),l=new e["default"](f.extend({},b.pollingConfiguration,j)),m={ws:h,xhr_streaming:k,xhr_polling:l};b.__esModule=!0,b["default"]=m},function(a,b,c){"use strict";function d(a,b,c){var d=a+(b.encrypted?"s":""),e=b.encrypted?b.hostEncrypted:b.hostUnencrypted;return d+"://"+e+c}function e(a,b){var c="/app/"+a,d="?protocol="+f["default"].PROTOCOL+"&client=js&version="+f["default"].VERSION+(b?"&"+b:"");return c+d}var f=c(5);b.ws={getInitial:function(a,b){return d("ws",b,e(a,"flash=false"))}},b.http={getInitial:function(a,b){var c=(b.httpPath||"/pusher")+e(a);return d("http",b,c)}},b.sockjs={getInitial:function(a,b){return d("http",b,b.httpPath||"/pusher")},getPath:function(a,b){return e(a)}}},function(a,b,c){"use strict";var d=c(22),e=function(){function a(a){this.hooks=a}return a.prototype.isSupported=function(a){return this.hooks.isSupported(a)},a.prototype.createConnection=function(a,b,c,e){return new d["default"](this.hooks,a,b,c,e)},a}();b.__esModule=!0,b["default"]=e},function(a,b,c){"use strict";var d=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},e=c(11),f=c(9),g=c(23),h=c(8),i=c(2),j=function(a){function b(b,c,d,e,f){a.call(this),this.initialize=i["default"].transportConnectionInitializer,this.hooks=b,this.name=c,this.priority=d,this.key=e,this.options=f,this.state="new",this.timeline=f.timeline,this.activityTimeout=f.activityTimeout,this.id=this.timeline.generateUniqueID()}return d(b,a),b.prototype.handlesActivityChecks=function(){return Boolean(this.hooks.handlesActivityChecks)},b.prototype.supportsPing=function(){return Boolean(this.hooks.supportsPing)},b.prototype.connect=function(){var a=this;if(this.socket||"initialized"!==this.state)return!1;var b=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(b,this.options)}catch(c){return e["default"].defer(function(){a.onError(c),a.changeState("closed")}),!1}return this.bindListeners(),h["default"].debug("Connecting",{transport:this.name,url:b}),this.changeState("connecting"),!0},b.prototype.close=function(){return!!this.socket&&(this.socket.close(),!0)},b.prototype.send=function(a){var b=this;return"open"===this.state&&(e["default"].defer(function(){b.socket&&b.socket.send(a)}),!0)},b.prototype.ping=function(){"open"===this.state&&this.supportsPing()&&this.socket.ping()},b.prototype.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0},b.prototype.onError=function(a){this.emit("error",{type:"WebSocketError",error:a}),this.timeline.error(this.buildTimelineMessage({error:a.toString()}))},b.prototype.onClose=function(a){a?this.changeState("closed",{code:a.code,reason:a.reason,wasClean:a.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0},b.prototype.onMessage=function(a){this.emit("message",a)},b.prototype.onActivity=function(){this.emit("activity")},b.prototype.bindListeners=function(){var a=this;this.socket.onopen=function(){a.onOpen()},this.socket.onerror=function(b){a.onError(b)},this.socket.onclose=function(b){a.onClose(b)},this.socket.onmessage=function(b){a.onMessage(b)},this.supportsPing()&&(this.socket.onactivity=function(){a.onActivity()})},b.prototype.unbindListeners=function(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))},b.prototype.changeState=function(a,b){this.state=a,this.timeline.info(this.buildTimelineMessage({state:a,params:b})),this.emit(a,b)},b.prototype.buildTimelineMessage=function(a){return f.extend({cid:this.id},a)},b}(g["default"]);b.__esModule=!0,b["default"]=j},function(a,b,c){"use strict";var d=c(9),e=c(24),f=function(){function a(a){this.callbacks=new e["default"],this.global_callbacks=[],this.failThrough=a}return a.prototype.bind=function(a,b,c){return this.callbacks.add(a,b,c),this},a.prototype.bind_global=function(a){return this.global_callbacks.push(a),this},a.prototype.unbind=function(a,b,c){return this.callbacks.remove(a,b,c),this},a.prototype.unbind_global=function(a){return a?(this.global_callbacks=d.filter(this.global_callbacks||[],function(b){return b!==a}),this):(this.global_callbacks=[],this)},a.prototype.unbind_all=function(){return this.unbind(),this.unbind_global(),this},a.prototype.emit=function(a,b){var c;for(c=0;c<this.global_callbacks.length;c++)this.global_callbacks[c](a,b);var d=this.callbacks.get(a);if(d&&d.length>0)for(c=0;c<d.length;c++)d[c].fn.call(d[c].context||window,b);else this.failThrough&&this.failThrough(a,b);return this},a}();b.__esModule=!0,b["default"]=f},function(a,b,c){"use strict";function d(a){return"_"+a}var e=c(9),f=function(){function a(){this._callbacks={}}return a.prototype.get=function(a){return this._callbacks[d(a)]},a.prototype.add=function(a,b,c){var e=d(a);this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].push({fn:b,context:c})},a.prototype.remove=function(a,b,c){if(!a&&!b&&!c)return void(this._callbacks={});var f=a?[d(a)]:e.keys(this._callbacks);b||c?this.removeCallback(f,b,c):this.removeAllCallbacks(f)},a.prototype.removeCallback=function(a,b,c){e.apply(a,function(a){this._callbacks[a]=e.filter(this._callbacks[a]||[],function(a){return b&&b!==a.fn||c&&c!==a.context}),0===this._callbacks[a].length&&delete this._callbacks[a]},this)},a.prototype.removeAllCallbacks=function(a){e.apply(a,function(a){delete this._callbacks[a]},this)},a}();b.__esModule=!0,b["default"]=f},function(a,b,c){"use strict";var d=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},e=c(23),f=function(a){function b(){a.call(this);var b=this;void 0!==window.addEventListener&&(window.addEventListener("online",function(){b.emit("online")},!1),window.addEventListener("offline",function(){b.emit("offline")},!1))}return d(b,a),b.prototype.isOnline=function(){return void 0===window.navigator.onLine||window.navigator.onLine},b}(e["default"]);b.NetInfo=f,b.Network=new f},function(a,b){"use strict";var c=function(a){var b;return b=a.encrypted?[":best_connected_ever",":ws_loop",[":delayed",2e3,[":http_fallback_loop"]]]:[":best_connected_ever",":ws_loop",[":delayed",2e3,[":wss_loop"]],[":delayed",5e3,[":http_fallback_loop"]]],[[":def","ws_options",{hostUnencrypted:a.wsHost+":"+a.wsPort,hostEncrypted:a.wsHost+":"+a.wssPort}],[":def","wss_options",[":extend",":ws_options",{encrypted:!0}]],[":def","sockjs_options",{hostUnencrypted:a.httpHost+":"+a.httpPort,hostEncrypted:a.httpHost+":"+a.httpsPort,httpPath:a.httpPath}],[":def","timeouts",{loop:!0,timeout:15e3,timeoutLimit:6e4}],[":def","ws_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:a.activity_timeout}]],[":def","streaming_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:a.activity_timeout}]],[":def_transport","ws","ws",3,":ws_options",":ws_manager"],[":def_transport","wss","ws",3,":wss_options",":ws_manager"],[":def_transport","sockjs","sockjs",1,":sockjs_options"],[":def_transport","xhr_streaming","xhr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xdr_streaming","xdr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xhr_polling","xhr_polling",1,":sockjs_options"],[":def_transport","xdr_polling","xdr_polling",1,":sockjs_options"],[":def","ws_loop",[":sequential",":timeouts",":ws"]],[":def","wss_loop",[":sequential",":timeouts",":wss"]],[":def","sockjs_loop",[":sequential",":timeouts",":sockjs"]],[":def","streaming_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_streaming"],":xhr_streaming",":xdr_streaming"]]],[":def","polling_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_polling"],":xhr_polling",":xdr_polling"]]],[":def","http_loop",[":if",[":is_supported",":streaming_loop"],[":best_connected_ever",":streaming_loop",[":delayed",4e3,[":polling_loop"]]],[":polling_loop"]]],[":def","http_fallback_loop",[":if",[":is_supported",":http_loop"],[":http_loop"],[":sockjs_loop"]]],[":def","strategy",[":cached",18e5,[":first_connected",[":if",[":is_supported",":ws"],b,":http_fallback_loop"]]]]]};b.__esModule=!0,b["default"]=c},function(a,b,c){"use strict";function d(){var a=this;a.timeline.info(a.buildTimelineMessage({transport:a.name+(a.options.encrypted?"s":"")})),a.hooks.isInitialized()?a.changeState("initialized"):a.hooks.file?(a.changeState("initializing"),e.Dependencies.load(a.hooks.file,{encrypted:a.options.encrypted},function(b,c){a.hooks.isInitialized()?(a.changeState("initialized"),c(!0)):(b&&a.onError(b),a.onClose(),c(!1))})):a.onClose()}var e=c(3);b.__esModule=!0,b["default"]=d},function(a,b,c){"use strict";var d=c(29),e=c(31);e["default"].createXDR=function(a,b){return this.createRequest(d["default"],a,b)},b.__esModule=!0,b["default"]=e["default"]},function(a,b,c){"use strict";var d=c(30),e={getRequest:function(a){var b=new window.XDomainRequest;return b.ontimeout=function(){a.emit("error",new d.RequestTimedOut),a.close()},b.onerror=function(b){a.emit("error",b),a.close()},b.onprogress=function(){b.responseText&&b.responseText.length>0&&a.onChunk(200,b.responseText)},b.onload=function(){b.responseText&&b.responseText.length>0&&a.onChunk(200,b.responseText),a.emit("finished",200),a.close()},b},abortRequest:function(a){a.ontimeout=a.onerror=a.onprogress=a.onload=null,a.abort()}};b.__esModule=!0,b["default"]=e},function(a,b){"use strict";var c=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},d=function(a){function b(){a.apply(this,arguments)}return c(b,a),b}(Error);b.BadEventName=d;var e=function(a){function b(){a.apply(this,arguments)}return c(b,a),b}(Error);b.RequestTimedOut=e;var f=function(a){function b(){a.apply(this,arguments)}return c(b,a),b}(Error);b.TransportPriorityTooLow=f;var g=function(a){function b(){a.apply(this,arguments)}return c(b,a),b}(Error);b.TransportClosed=g;var h=function(a){function b(){a.apply(this,arguments)}return c(b,a),b}(Error);b.UnsupportedTransport=h;var i=function(a){function b(){a.apply(this,arguments)}return c(b,a),b}(Error);b.UnsupportedStrategy=i},function(a,b,c){"use strict";var d=c(32),e=c(33),f=c(35),g=c(36),h=c(37),i={createStreamingSocket:function(a){return this.createSocket(f["default"],a)},createPollingSocket:function(a){return this.createSocket(g["default"],a)},createSocket:function(a,b){return new e["default"](a,b)},createXHR:function(a,b){return this.createRequest(h["default"],a,b)},createRequest:function(a,b,c){return new d["default"](a,b,c)}};b.__esModule=!0,b["default"]=i},function(a,b,c){"use strict";var d=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},e=c(2),f=c(23),g=262144,h=function(a){function b(b,c,d){a.call(this),this.hooks=b,this.method=c,this.url=d}return d(b,a),b.prototype.start=function(a){var b=this;this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=function(){b.close()},e["default"].addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(a)},b.prototype.close=function(){this.unloader&&(e["default"].removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)},b.prototype.onChunk=function(a,b){for(;;){var c=this.advanceBuffer(b);if(!c)break;this.emit("chunk",{status:a,data:c})}this.isBufferTooLong(b)&&this.emit("buffer_too_long")},b.prototype.advanceBuffer=function(a){var b=a.slice(this.position),c=b.indexOf("\n");return c!==-1?(this.position+=c+1,b.slice(0,c)):null},b.prototype.isBufferTooLong=function(a){return this.position===a.length&&a.length>g},b}(f["default"]);b.__esModule=!0,b["default"]=h},function(a,b,c){"use strict";function d(a){var b=/([^\?]*)\/*(\??.*)/.exec(a);return{base:b[1],queryString:b[2]}}function e(a,b){return a.base+"/"+b+"/xhr_send"}function f(a){var b=a.indexOf("?")===-1?"?":"&";return a+b+"t="+ +new Date+"&n="+m++}function g(a,b){var c=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(a);return c[1]+b+c[3]}function h(a){return Math.floor(Math.random()*a)}function i(a){for(var b=[],c=0;c<a;c++)b.push(h(32).toString(32));return b.join("")}var j=c(34),k=c(11),l=c(2),m=1,n=function(){function a(a,b){this.hooks=a,this.session=h(1e3)+"/"+i(8),
this.location=d(b),this.readyState=j["default"].CONNECTING,this.openStream()}return a.prototype.send=function(a){return this.sendRaw(JSON.stringify([a]))},a.prototype.ping=function(){this.hooks.sendHeartbeat(this)},a.prototype.close=function(a,b){this.onClose(a,b,!0)},a.prototype.sendRaw=function(a){if(this.readyState!==j["default"].OPEN)return!1;try{return l["default"].createSocketRequest("POST",f(e(this.location,this.session))).start(a),!0}catch(b){return!1}},a.prototype.reconnect=function(){this.closeStream(),this.openStream()},a.prototype.onClose=function(a,b,c){this.closeStream(),this.readyState=j["default"].CLOSED,this.onclose&&this.onclose({code:a,reason:b,wasClean:c})},a.prototype.onChunk=function(a){if(200===a.status){this.readyState===j["default"].OPEN&&this.onActivity();var b,c=a.data.slice(0,1);switch(c){case"o":b=JSON.parse(a.data.slice(1)||"{}"),this.onOpen(b);break;case"a":b=JSON.parse(a.data.slice(1)||"[]");for(var d=0;d<b.length;d++)this.onEvent(b[d]);break;case"m":b=JSON.parse(a.data.slice(1)||"null"),this.onEvent(b);break;case"h":this.hooks.onHeartbeat(this);break;case"c":b=JSON.parse(a.data.slice(1)||"[]"),this.onClose(b[0],b[1],!0)}}},a.prototype.onOpen=function(a){this.readyState===j["default"].CONNECTING?(a&&a.hostname&&(this.location.base=g(this.location.base,a.hostname)),this.readyState=j["default"].OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)},a.prototype.onEvent=function(a){this.readyState===j["default"].OPEN&&this.onmessage&&this.onmessage({data:a})},a.prototype.onActivity=function(){this.onactivity&&this.onactivity()},a.prototype.onError=function(a){this.onerror&&this.onerror(a)},a.prototype.openStream=function(){var a=this;this.stream=l["default"].createSocketRequest("POST",f(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",function(b){a.onChunk(b)}),this.stream.bind("finished",function(b){a.hooks.onFinished(a,b)}),this.stream.bind("buffer_too_long",function(){a.reconnect()});try{this.stream.start()}catch(b){k["default"].defer(function(){a.onError(b),a.onClose(1006,"Could not start streaming",!1)})}},a.prototype.closeStream=function(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)},a}();b.__esModule=!0,b["default"]=n},function(a,b){"use strict";var c;!function(a){a[a.CONNECTING=0]="CONNECTING",a[a.OPEN=1]="OPEN",a[a.CLOSED=3]="CLOSED"}(c||(c={})),b.__esModule=!0,b["default"]=c},function(a,b){"use strict";var c={getReceiveURL:function(a,b){return a.base+"/"+b+"/xhr_streaming"+a.queryString},onHeartbeat:function(a){a.sendRaw("[]")},sendHeartbeat:function(a){a.sendRaw("[]")},onFinished:function(a,b){a.onClose(1006,"Connection interrupted ("+b+")",!1)}};b.__esModule=!0,b["default"]=c},function(a,b){"use strict";var c={getReceiveURL:function(a,b){return a.base+"/"+b+"/xhr"+a.queryString},onHeartbeat:function(){},sendHeartbeat:function(a){a.sendRaw("[]")},onFinished:function(a,b){200===b?a.reconnect():a.onClose(1006,"Connection interrupted ("+b+")",!1)}};b.__esModule=!0,b["default"]=c},function(a,b,c){"use strict";var d=c(2),e={getRequest:function(a){var b=d["default"].getXHRAPI(),c=new b;return c.onreadystatechange=c.onprogress=function(){switch(c.readyState){case 3:c.responseText&&c.responseText.length>0&&a.onChunk(c.status,c.responseText);break;case 4:c.responseText&&c.responseText.length>0&&a.onChunk(c.status,c.responseText),a.emit("finished",c.status),a.close()}},c},abortRequest:function(a){a.onreadystatechange=null,a.abort()}};b.__esModule=!0,b["default"]=e},function(a,b,c){"use strict";var d=c(9),e=c(11),f=c(39),g=function(){function a(a,b,c){this.key=a,this.session=b,this.events=[],this.options=c||{},this.sent=0,this.uniqueID=0}return a.prototype.log=function(a,b){a<=this.options.level&&(this.events.push(d.extend({},b,{timestamp:e["default"].now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())},a.prototype.error=function(a){this.log(f["default"].ERROR,a)},a.prototype.info=function(a){this.log(f["default"].INFO,a)},a.prototype.debug=function(a){this.log(f["default"].DEBUG,a)},a.prototype.isEmpty=function(){return 0===this.events.length},a.prototype.send=function(a,b){var c=this,e=d.extend({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],a(e,function(a,d){a||c.sent++,b&&b(a,d)}),!0},a.prototype.generateUniqueID=function(){return this.uniqueID++,this.uniqueID},a}();b.__esModule=!0,b["default"]=g},function(a,b){"use strict";var c;!function(a){a[a.ERROR=3]="ERROR",a[a.INFO=6]="INFO",a[a.DEBUG=7]="DEBUG"}(c||(c={})),b.__esModule=!0,b["default"]=c},function(a,b,c){"use strict";function d(a){return function(b){return[a.apply(this,arguments),b]}}function e(a){return"string"==typeof a&&":"===a.charAt(0)}function f(a,b){return b[a.slice(1)]}function g(a,b){if(0===a.length)return[[],b];var c=j(a[0],b),d=g(a.slice(1),c[1]);return[[c[0]].concat(d[0]),d[1]]}function h(a,b){if(!e(a))return[a,b];var c=f(a,b);if(void 0===c)throw"Undefined symbol "+a;return[c,b]}function i(a,b){if(e(a[0])){var c=f(a[0],b);if(a.length>1){if("function"!=typeof c)throw"Calling non-function "+a[0];var d=[k.extend({},b)].concat(k.map(a.slice(1),function(a){return j(a,k.extend({},b))[0]}));return c.apply(this,d)}return[c,b]}return g(a,b)}function j(a,b){return"string"==typeof a?h(a,b):"object"==typeof a&&a instanceof Array&&a.length>0?i(a,b):[a,b]}var k=c(9),l=c(11),m=c(41),n=c(30),o=c(55),p=c(56),q=c(57),r=c(58),s=c(59),t=c(60),u=c(61),v=c(2),w=v["default"].Transports;b.build=function(a,b){var c=k.extend({},y,b);return j(a,c)[1].strategy};var x={isSupported:function(){return!1},connect:function(a,b){var c=l["default"].defer(function(){b(new n.UnsupportedStrategy)});return{abort:function(){c.ensureAborted()},forceMinPriority:function(){}}}},y={extend:function(a,b,c){return[k.extend({},b,c),a]},def:function(a,b,c){if(void 0!==a[b])throw"Redefining symbol "+b;return a[b]=c,[void 0,a]},def_transport:function(a,b,c,d,e,f){var g=w[c];if(!g)throw new n.UnsupportedTransport(c);var h,i=!(a.enabledTransports&&k.arrayIndexOf(a.enabledTransports,b)===-1||a.disabledTransports&&k.arrayIndexOf(a.disabledTransports,b)!==-1);h=i?new o["default"](b,d,f?f.getAssistant(g):g,k.extend({key:a.key,encrypted:a.encrypted,timeline:a.timeline,ignoreNullOrigin:a.ignoreNullOrigin},e)):x;var j=a.def(a,b,h)[1];return j.Transports=a.Transports||{},j.Transports[b]=h,[void 0,j]},transport_manager:d(function(a,b){return new m["default"](b)}),sequential:d(function(a,b){var c=Array.prototype.slice.call(arguments,2);return new p["default"](c,b)}),cached:d(function(a,b,c){return new r["default"](c,a.Transports,{ttl:b,timeline:a.timeline,encrypted:a.encrypted})}),first_connected:d(function(a,b){return new u["default"](b)}),best_connected_ever:d(function(){var a=Array.prototype.slice.call(arguments,1);return new q["default"](a)}),delayed:d(function(a,b,c){return new s["default"](c,{delay:b})}),"if":d(function(a,b,c,d){return new t["default"](b,c,d)}),is_supported:d(function(a,b){return function(){return b.isSupported()}})}},function(a,b,c){"use strict";var d=c(42),e=function(){function a(a){this.options=a||{},this.livesLeft=this.options.lives||1/0}return a.prototype.getAssistant=function(a){return d["default"].createAssistantToTheTransportManager(this,a,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})},a.prototype.isAlive=function(){return this.livesLeft>0},a.prototype.reportDeath=function(){this.livesLeft-=1},a}();b.__esModule=!0,b["default"]=e},function(a,b,c){"use strict";var d=c(43),e=c(44),f=c(47),g=c(48),h=c(49),i=c(50),j=c(51),k=c(53),l=c(54),m={createChannels:function(){return new l["default"]},createConnectionManager:function(a,b){return new k["default"](a,b)},createChannel:function(a,b){return new j["default"](a,b)},createPrivateChannel:function(a,b){return new i["default"](a,b)},createPresenceChannel:function(a,b){return new h["default"](a,b)},createTimelineSender:function(a,b){return new g["default"](a,b)},createAuthorizer:function(a,b){return new f["default"](a,b)},createHandshake:function(a,b){return new e["default"](a,b)},createAssistantToTheTransportManager:function(a,b,c){return new d["default"](a,b,c)}};b.__esModule=!0,b["default"]=m},function(a,b,c){"use strict";var d=c(11),e=c(9),f=function(){function a(a,b,c){this.manager=a,this.transport=b,this.minPingDelay=c.minPingDelay,this.maxPingDelay=c.maxPingDelay,this.pingDelay=void 0}return a.prototype.createConnection=function(a,b,c,f){var g=this;f=e.extend({},f,{activityTimeout:this.pingDelay});var h=this.transport.createConnection(a,b,c,f),i=null,j=function(){h.unbind("open",j),h.bind("closed",k),i=d["default"].now()},k=function(a){if(h.unbind("closed",k),1002===a.code||1003===a.code)g.manager.reportDeath();else if(!a.wasClean&&i){var b=d["default"].now()-i;b<2*g.maxPingDelay&&(g.manager.reportDeath(),g.pingDelay=Math.max(b/2,g.minPingDelay))}};return h.bind("open",j),h},a.prototype.isSupported=function(a){return this.manager.isAlive()&&this.transport.isSupported(a)},a}();b.__esModule=!0,b["default"]=f},function(a,b,c){"use strict";var d=c(9),e=c(45),f=c(46),g=function(){function a(a,b){this.transport=a,this.callback=b,this.bindListeners()}return a.prototype.close=function(){this.unbindListeners(),this.transport.close()},a.prototype.bindListeners=function(){var a=this;this.onMessage=function(b){a.unbindListeners();var c;try{c=e.processHandshake(b)}catch(d){return a.finish("error",{error:d}),void a.transport.close()}"connected"===c.action?a.finish("connected",{connection:new f["default"](c.id,a.transport),activityTimeout:c.activityTimeout}):(a.finish(c.action,{error:c.error}),a.transport.close())},this.onClosed=function(b){a.unbindListeners();var c=e.getCloseAction(b)||"backoff",d=e.getCloseError(b);a.finish(c,{error:d})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)},a.prototype.unbindListeners=function(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)},a.prototype.finish=function(a,b){this.callback(d.extend({transport:this.transport,action:a},b))},a}();b.__esModule=!0,b["default"]=g},function(a,b){"use strict";b.decodeMessage=function(a){try{var b=JSON.parse(a.data);if("string"==typeof b.data)try{b.data=JSON.parse(b.data)}catch(c){if(!(c instanceof SyntaxError))throw c}return b}catch(c){throw{type:"MessageParseError",error:c,data:a.data}}},b.encodeMessage=function(a){return JSON.stringify(a)},b.processHandshake=function(a){if(a=b.decodeMessage(a),"pusher:connection_established"===a.event){if(!a.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:a.data.socket_id,activityTimeout:1e3*a.data.activity_timeout}}if("pusher:error"===a.event)return{action:this.getCloseAction(a.data),error:this.getCloseError(a.data)};throw"Invalid handshake"},b.getCloseAction=function(a){return a.code<4e3?a.code>=1002&&a.code<=1004?"backoff":null:4e3===a.code?"ssl_only":a.code<4100?"refused":a.code<4200?"backoff":a.code<4300?"retry":"refused"},b.getCloseError=function(a){return 1e3!==a.code&&1001!==a.code?{type:"PusherError",data:{code:a.code,message:a.reason||a.message}}:null}},function(a,b,c){"use strict";var d=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},e=c(9),f=c(23),g=c(45),h=c(8),i=function(a){function b(b,c){a.call(this),this.id=b,this.transport=c,this.activityTimeout=c.activityTimeout,this.bindListeners()}return d(b,a),b.prototype.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()},b.prototype.send=function(a){return this.transport.send(a)},b.prototype.send_event=function(a,b,c){var d={event:a,data:b};return c&&(d.channel=c),h["default"].debug("Event sent",d),this.send(g.encodeMessage(d))},b.prototype.ping=function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})},b.prototype.close=function(){this.transport.close()},b.prototype.bindListeners=function(){var a=this,b={message:function(b){var c;try{c=g.decodeMessage(b)}catch(d){a.emit("error",{type:"MessageParseError",error:d,data:b.data})}if(void 0!==c){switch(h["default"].debug("Event recd",c),c.event){case"pusher:error":a.emit("error",{type:"PusherError",data:c.data});break;case"pusher:ping":a.emit("ping");break;case"pusher:pong":a.emit("pong")}a.emit("message",c)}},activity:function(){a.emit("activity")},error:function(b){a.emit("error",{type:"WebSocketError",error:b})},closed:function(b){c(),b&&b.code&&a.handleCloseEvent(b),a.transport=null,a.emit("closed")}},c=function(){e.objectApply(b,function(b,c){a.transport.unbind(c,b)})};e.objectApply(b,function(b,c){a.transport.bind(c,b)})},b.prototype.handleCloseEvent=function(a){var b=g.getCloseAction(a),c=g.getCloseError(a);c&&this.emit("error",c),b&&this.emit(b)},b}(f["default"]);b.__esModule=!0,b["default"]=i},function(a,b,c){"use strict";var d=c(2),e=function(){function a(a,b){this.channel=a;var c=b.authTransport;if("undefined"==typeof d["default"].getAuthorizers()[c])throw"'"+c+"' is not a recognized auth transport";this.type=c,this.options=b,this.authOptions=(b||{}).auth||{}}return a.prototype.composeQuery=function(a){var b="socket_id="+encodeURIComponent(a)+"&channel_name="+encodeURIComponent(this.channel.name);for(var c in this.authOptions.params)b+="&"+encodeURIComponent(c)+"="+encodeURIComponent(this.authOptions.params[c]);return b},a.prototype.authorize=function(b,c){return a.authorizers=a.authorizers||d["default"].getAuthorizers(),a.authorizers[this.type].call(this,d["default"],b,c)},a}();b.__esModule=!0,b["default"]=e},function(a,b,c){"use strict";var d=c(2),e=function(){function a(a,b){this.timeline=a,this.options=b||{}}return a.prototype.send=function(a,b){this.timeline.isEmpty()||this.timeline.send(d["default"].TimelineTransport.getAgent(this,a),b)},a}();b.__esModule=!0,b["default"]=e},function(a,b,c){"use strict";var d=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},e=c(50),f=c(8),g=c(52),h=function(a){function b(b,c){a.call(this,b,c),this.members=new g["default"]}return d(b,a),b.prototype.authorize=function(b,c){var d=this;a.prototype.authorize.call(this,b,function(a,b){if(!a){if(void 0===b.channel_data)return f["default"].warn("Invalid auth response for channel '"+d.name+"', expected 'channel_data' field"),void c("Invalid auth response");var e=JSON.parse(b.channel_data);d.members.setMyID(e.user_id)}c(a,b)})},b.prototype.handleEvent=function(a,b){switch(a){case"pusher_internal:subscription_succeeded":this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(b),this.emit("pusher:subscription_succeeded",this.members));break;case"pusher_internal:member_added":var c=this.members.addMember(b);this.emit("pusher:member_added",c);break;case"pusher_internal:member_removed":var d=this.members.removeMember(b);d&&this.emit("pusher:member_removed",d);break;default:e["default"].prototype.handleEvent.call(this,a,b)}},b.prototype.disconnect=function(){this.members.reset(),a.prototype.disconnect.call(this)},b}(e["default"]);b.__esModule=!0,b["default"]=h},function(a,b,c){"use strict";var d=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},e=c(42),f=c(51),g=function(a){function b(){a.apply(this,arguments)}return d(b,a),b.prototype.authorize=function(a,b){var c=e["default"].createAuthorizer(this,this.pusher.config);return c.authorize(a,b)},b}(f["default"]);b.__esModule=!0,b["default"]=g},function(a,b,c){"use strict";var d=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},e=c(23),f=c(30),g=c(8),h=function(a){function b(b,c){a.call(this,function(a,c){g["default"].debug("No callbacks on "+b+" for "+a)}),this.name=b,this.pusher=c,this.subscribed=!1,this.subscriptionPending=!1,this.subscriptionCancelled=!1}return d(b,a),b.prototype.authorize=function(a,b){return b(!1,{})},b.prototype.trigger=function(a,b){if(0!==a.indexOf("client-"))throw new f.BadEventName("Event '"+a+"' does not start with 'client-'");return this.pusher.send_event(a,b,this.name)},b.prototype.disconnect=function(){this.subscribed=!1},b.prototype.handleEvent=function(a,b){0===a.indexOf("pusher_internal:")?"pusher_internal:subscription_succeeded"===a&&(this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",b)):this.emit(a,b)},b.prototype.subscribe=function(){var a=this;this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,function(b,c){b?a.handleEvent("pusher:subscription_error",c):a.pusher.send_event("pusher:subscribe",{auth:c.auth,channel_data:c.channel_data,channel:a.name})}))},b.prototype.unsubscribe=function(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})},b.prototype.cancelSubscription=function(){this.subscriptionCancelled=!0},b.prototype.reinstateSubscription=function(){this.subscriptionCancelled=!1},b}(e["default"]);b.__esModule=!0,b["default"]=h},function(a,b,c){"use strict";var d=c(9),e=function(){function a(){this.reset()}return a.prototype.get=function(a){return Object.prototype.hasOwnProperty.call(this.members,a)?{id:a,info:this.members[a]}:null},a.prototype.each=function(a){var b=this;d.objectApply(this.members,function(c,d){a(b.get(d))})},a.prototype.setMyID=function(a){this.myID=a},a.prototype.onSubscription=function(a){this.members=a.presence.hash,this.count=a.presence.count,this.me=this.get(this.myID)},a.prototype.addMember=function(a){return null===this.get(a.user_id)&&this.count++,this.members[a.user_id]=a.user_info,this.get(a.user_id)},a.prototype.removeMember=function(a){var b=this.get(a.user_id);return b&&(delete this.members[a.user_id],this.count--),b},a.prototype.reset=function(){this.members={},this.count=0,this.myID=null,this.me=null},a}();b.__esModule=!0,b["default"]=e},function(a,b,c){"use strict";var d=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},e=c(23),f=c(12),g=c(8),h=c(9),i=c(2),j=function(a){function b(b,c){var d=this;a.call(this),this.key=b,this.options=c||{},this.state="initialized",this.connection=null,this.encrypted=!!c.encrypted,this.timeline=this.options.timeline,this.connectionCallbacks=this.buildConnectionCallbacks(),this.errorCallbacks=this.buildErrorCallbacks(),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var e=i["default"].getNetwork();e.bind("online",function(){d.timeline.info({netinfo:"online"}),"connecting"!==d.state&&"unavailable"!==d.state||d.retryIn(0)}),e.bind("offline",function(){d.timeline.info({netinfo:"offline"}),d.connection&&d.sendActivityCheck()}),this.updateStrategy()}return d(b,a),b.prototype.connect=function(){if(!this.connection&&!this.runner){if(!this.strategy.isSupported())return void this.updateState("failed");this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}},b.prototype.send=function(a){return!!this.connection&&this.connection.send(a)},b.prototype.send_event=function(a,b,c){return!!this.connection&&this.connection.send_event(a,b,c)},b.prototype.disconnect=function(){this.disconnectInternally(),this.updateState("disconnected")},b.prototype.isEncrypted=function(){return this.encrypted},b.prototype.startConnecting=function(){var a=this,b=function(c,d){c?a.runner=a.strategy.connect(0,b):"error"===d.action?(a.emit("error",{type:"HandshakeError",error:d.error}),a.timeline.error({handshakeError:d.error})):(a.abortConnecting(),a.handshakeCallbacks[d.action](d))};this.runner=this.strategy.connect(0,b)},b.prototype.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)},b.prototype.disconnectInternally=function(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection){var a=this.abandonConnection();a.close()}},b.prototype.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,encrypted:this.encrypted})},b.prototype.retryIn=function(a){var b=this;this.timeline.info({action:"retry",delay:a}),a>0&&this.emit("connecting_in",Math.round(a/1e3)),this.retryTimer=new f.OneOffTimer(a||0,function(){b.disconnectInternally(),b.connect()})},b.prototype.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)},b.prototype.setUnavailableTimer=function(){var a=this;this.unavailableTimer=new f.OneOffTimer(this.options.unavailableTimeout,function(){a.updateState("unavailable")})},b.prototype.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()},b.prototype.sendActivityCheck=function(){var a=this;this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new f.OneOffTimer(this.options.pongTimeout,function(){a.timeline.error({pong_timed_out:a.options.pongTimeout}),a.retryIn(0)})},b.prototype.resetActivityCheck=function(){var a=this;this.stopActivityCheck(),this.connection.handlesActivityChecks()||(this.activityTimer=new f.OneOffTimer(this.activityTimeout,function(){a.sendActivityCheck()}))},b.prototype.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()},b.prototype.buildConnectionCallbacks=function(){var a=this;return{message:function(b){a.resetActivityCheck(),a.emit("message",b)},ping:function(){a.send_event("pusher:pong",{})},activity:function(){a.resetActivityCheck()},error:function(b){a.emit("error",{type:"WebSocketError",error:b})},closed:function(){a.abandonConnection(),a.shouldRetry()&&a.retryIn(1e3)}}},b.prototype.buildHandshakeCallbacks=function(a){var b=this;return h.extend({},a,{connected:function(a){b.activityTimeout=Math.min(b.options.activityTimeout,a.activityTimeout,a.connection.activityTimeout||1/0),b.clearUnavailableTimer(),b.setConnection(a.connection),b.socket_id=b.connection.id,b.updateState("connected",{socket_id:b.socket_id})}})},b.prototype.buildErrorCallbacks=function(){var a=this,b=function(b){return function(c){c.error&&a.emit("error",{type:"WebSocketError",error:c.error}),b(c)}};return{ssl_only:b(function(){a.encrypted=!0,a.updateStrategy(),a.retryIn(0)}),refused:b(function(){a.disconnect()}),backoff:b(function(){a.retryIn(1e3)}),retry:b(function(){a.retryIn(0)})}},b.prototype.setConnection=function(a){this.connection=a;for(var b in this.connectionCallbacks)this.connection.bind(b,this.connectionCallbacks[b]);this.resetActivityCheck()},b.prototype.abandonConnection=function(){if(this.connection){this.stopActivityCheck();for(var a in this.connectionCallbacks)this.connection.unbind(a,this.connectionCallbacks[a]);var b=this.connection;return this.connection=null,b}},b.prototype.updateState=function(a,b){var c=this.state;if(this.state=a,c!==a){var d=a;"connected"===d&&(d+=" with new socket ID "+b.socket_id),g["default"].debug("State changed",c+" -> "+d),this.timeline.info({state:a,params:b}),this.emit("state_change",{previous:c,current:a}),this.emit(a,b)}},b.prototype.shouldRetry=function(){return"connecting"===this.state||"connected"===this.state},b}(e["default"]);b.__esModule=!0,b["default"]=j},function(a,b,c){"use strict";function d(a,b){return 0===a.indexOf("private-")?f["default"].createPrivateChannel(a,b):0===a.indexOf("presence-")?f["default"].createPresenceChannel(a,b):f["default"].createChannel(a,b)}var e=c(9),f=c(42),g=function(){function a(){this.channels={}}return a.prototype.add=function(a,b){return this.channels[a]||(this.channels[a]=d(a,b)),this.channels[a]},a.prototype.all=function(){return e.values(this.channels)},a.prototype.find=function(a){return this.channels[a]},a.prototype.remove=function(a){var b=this.channels[a];return delete this.channels[a],b},a.prototype.disconnect=function(){e.objectApply(this.channels,function(a){a.disconnect()})},a}();b.__esModule=!0,b["default"]=g},function(a,b,c){"use strict";function d(a,b){return f["default"].defer(function(){b(a)}),{abort:function(){},forceMinPriority:function(){}}}var e=c(42),f=c(11),g=c(30),h=c(9),i=function(){function a(a,b,c,d){this.name=a,this.priority=b,this.transport=c,this.options=d||{}}return a.prototype.isSupported=function(){return this.transport.isSupported({encrypted:this.options.encrypted})},a.prototype.connect=function(a,b){var c=this;if(!this.isSupported())return d(new g.UnsupportedStrategy,b);if(this.priority<a)return d(new g.TransportPriorityTooLow,b);var f=!1,i=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),j=null,k=function(){i.unbind("initialized",k),i.connect()},l=function(){j=e["default"].createHandshake(i,function(a){f=!0,o(),b(null,a)})},m=function(a){o(),b(a)},n=function(){o();var a;a=h.safeJSONStringify(i),b(new g.TransportClosed(a))},o=function(){i.unbind("initialized",k),i.unbind("open",l),i.unbind("error",m),i.unbind("closed",n)};return i.bind("initialized",k),i.bind("open",l),i.bind("error",m),i.bind("closed",n),i.initialize(),{abort:function(){f||(o(),j?j.close():i.close())},forceMinPriority:function(a){f||c.priority<a&&(j?j.close():i.close())}}},a}();b.__esModule=!0,b["default"]=i},function(a,b,c){"use strict";var d=c(9),e=c(11),f=c(12),g=function(){function a(a,b){this.strategies=a,this.loop=Boolean(b.loop),this.failFast=Boolean(b.failFast),this.timeout=b.timeout,this.timeoutLimit=b.timeoutLimit}return a.prototype.isSupported=function(){return d.any(this.strategies,e["default"].method("isSupported"))},a.prototype.connect=function(a,b){var c=this,d=this.strategies,e=0,f=this.timeout,g=null,h=function(i,j){j?b(null,j):(e+=1,c.loop&&(e%=d.length),e<d.length?(f&&(f=2*f,c.timeoutLimit&&(f=Math.min(f,c.timeoutLimit))),g=c.tryStrategy(d[e],a,{timeout:f,failFast:c.failFast},h)):b(!0))};return g=this.tryStrategy(d[e],a,{timeout:f,failFast:this.failFast},h),{abort:function(){g.abort()},forceMinPriority:function(b){a=b,g&&g.forceMinPriority(b)}}},a.prototype.tryStrategy=function(a,b,c,d){var e=null,g=null;return c.timeout>0&&(e=new f.OneOffTimer(c.timeout,function(){g.abort(),d(!0)})),g=a.connect(b,function(a,b){a&&e&&e.isRunning()&&!c.failFast||(e&&e.ensureAborted(),d(a,b))}),{abort:function(){e&&e.ensureAborted(),g.abort()},forceMinPriority:function(a){g.forceMinPriority(a)}}},a}();b.__esModule=!0,b["default"]=g},function(a,b,c){"use strict";function d(a,b,c){var d=g.map(a,function(a,d,e,f){return a.connect(b,c(d,f))});return{abort:function(){g.apply(d,f)},forceMinPriority:function(a){g.apply(d,function(b){b.forceMinPriority(a)})}}}function e(a){return g.all(a,function(a){return Boolean(a.error)})}function f(a){a.error||a.aborted||(a.abort(),a.aborted=!0)}var g=c(9),h=c(11),i=function(){function a(a){this.strategies=a}return a.prototype.isSupported=function(){return g.any(this.strategies,h["default"].method("isSupported"))},a.prototype.connect=function(a,b){return d(this.strategies,a,function(a,c){return function(d,f){return c[a].error=d,d?void(e(c)&&b(!0)):(g.apply(c,function(a){a.forceMinPriority(f.transport.priority)}),void b(null,f))}})},a}();b.__esModule=!0,b["default"]=i},function(a,b,c){"use strict";function d(a){return"pusherTransport"+(a?"Encrypted":"Unencrypted")}function e(a){var b=i["default"].getLocalStorage();if(b)try{var c=b[d(a)];if(c)return JSON.parse(c)}catch(e){g(a)}return null}function f(a,b,c){var e=i["default"].getLocalStorage();if(e)try{e[d(a)]=k.safeJSONStringify({timestamp:h["default"].now(),transport:b,latency:c})}catch(f){}}function g(a){var b=i["default"].getLocalStorage();if(b)try{delete b[d(a)]}catch(c){}}var h=c(11),i=c(2),j=c(56),k=c(9),l=function(){function a(a,b,c){this.strategy=a,this.transports=b,this.ttl=c.ttl||18e5,this.encrypted=c.encrypted,this.timeline=c.timeline}return a.prototype.isSupported=function(){return this.strategy.isSupported()},a.prototype.connect=function(a,b){var c=this.encrypted,d=e(c),i=[this.strategy];if(d&&d.timestamp+this.ttl>=h["default"].now()){var k=this.transports[d.transport];k&&(this.timeline.info({cached:!0,transport:d.transport,latency:d.latency}),i.push(new j["default"]([k],{timeout:2*d.latency+1e3,failFast:!0})))}var l=h["default"].now(),m=i.pop().connect(a,function n(d,e){d?(g(c),i.length>0?(l=h["default"].now(),m=i.pop().connect(a,n)):b(d)):(f(c,e.transport.name,h["default"].now()-l),b(null,e))});return{abort:function(){m.abort()},forceMinPriority:function(b){a=b,m&&m.forceMinPriority(b)}}},a}();b.__esModule=!0,b["default"]=l},function(a,b,c){"use strict";var d=c(12),e=function(){function a(a,b){var c=b.delay;this.strategy=a,this.options={delay:c}}return a.prototype.isSupported=function(){return this.strategy.isSupported()},a.prototype.connect=function(a,b){var c,e=this.strategy,f=new d.OneOffTimer(this.options.delay,function(){c=e.connect(a,b)});return{abort:function(){f.ensureAborted(),c&&c.abort()},forceMinPriority:function(b){a=b,c&&c.forceMinPriority(b)}}},a}();b.__esModule=!0,b["default"]=e},function(a,b){"use strict";var c=function(){function a(a,b,c){this.test=a,this.trueBranch=b,this.falseBranch=c}return a.prototype.isSupported=function(){var a=this.test()?this.trueBranch:this.falseBranch;return a.isSupported()},a.prototype.connect=function(a,b){var c=this.test()?this.trueBranch:this.falseBranch;return c.connect(a,b)},a}();b.__esModule=!0,b["default"]=c},function(a,b){"use strict";var c=function(){function a(a){this.strategy=a}return a.prototype.isSupported=function(){return this.strategy.isSupported()},a.prototype.connect=function(a,b){var c=this.strategy.connect(a,function(a,d){d&&c.abort(),b(a,d)});return c},a}();b.__esModule=!0,b["default"]=c},function(a,b,c){"use strict";var d=c(5);b.getGlobalConfig=function(){return{wsHost:d["default"].host,wsPort:d["default"].ws_port,wssPort:d["default"].wss_port,httpHost:d["default"].sockjs_host,httpPort:d["default"].sockjs_http_port,httpsPort:d["default"].sockjs_https_port,httpPath:d["default"].sockjs_path,statsHost:d["default"].stats_host,authEndpoint:d["default"].channel_auth_endpoint,authTransport:d["default"].channel_auth_transport,activity_timeout:d["default"].activity_timeout,pong_timeout:d["default"].pong_timeout,unavailable_timeout:d["default"].unavailable_timeout}},b.getClusterConfig=function(a){return{wsHost:"ws-"+a+".pusher.com",httpHost:"sockjs-"+a+".pusher.com"}}}])});